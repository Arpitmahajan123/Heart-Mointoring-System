<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heart Rate Monitoring System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    borderRadius: {
                        lg: "var(--radius)",
                        md: "calc(var(--radius) - 2px)",
                        sm: "calc(var(--radius) - 4px)",
                    },
                    colors: {
                        background: "var(--background)",
                        foreground: "var(--foreground)",
                        card: {
                            DEFAULT: "var(--card)",
                            foreground: "var(--card-foreground)",
                        },
                        primary: {
                            DEFAULT: "var(--primary)",
                            foreground: "var(--primary-foreground)",
                        },
                        secondary: {
                            DEFAULT: "var(--secondary)",
                            foreground: "var(--secondary-foreground)",
                        },
                        muted: {
                            DEFAULT: "var(--muted)",
                            foreground: "var(--muted-foreground)",
                        },
                        accent: {
                            DEFAULT: "var(--accent)",
                            foreground: "var(--accent-foreground)",
                        },
                        destructive: {
                            DEFAULT: "var(--destructive)",
                            foreground: "var(--destructive-foreground)",
                        },
                        border: "var(--border)",
                        input: "var(--input)",
                        ring: "var(--ring)",
                    },
                    fontFamily: {
                        sans: ["var(--font-sans)"],
                    }
                },
            }
        };
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --background: hsl(210 40% 98%);
            --foreground: hsl(222.2 84% 4.9%);
            --card: hsl(0 0% 100%);
            --card-foreground: hsl(222.2 84% 4.9%);
            --primary: hsl(221.2 83.2% 53.3%);
            --primary-foreground: hsl(210 40% 98%);
            --secondary: hsl(186 100% 41%);
            --secondary-foreground: hsl(0 0% 100%);
            --muted: hsl(210 40% 96%);
            --muted-foreground: hsl(215.4 16.3% 46.9%);
            --accent: hsl(142.1 76.2% 36.3%);
            --accent-foreground: hsl(355.7 100% 97.3%);
            --destructive: hsl(0 84.2% 60.2%);
            --destructive-foreground: hsl(210 40% 98%);
            --border: hsl(214.3 31.8% 91.4%);
            --input: hsl(214.3 31.8% 91.4%);
            --ring: hsl(221.2 83.2% 53.3%);
            --radius: 0.5rem;
            --font-sans: 'Inter', system-ui, -apple-system, sans-serif;
        }

        * {
            border-color: hsl(var(--border));
        }

        body {
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
            font-family: var(--font-sans);
        }

        .pulse-animation {
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .health-status-healthy {
            background: linear-gradient(135deg, hsl(142.1 76.2% 36.3%) 0%, hsl(142.1 70% 45%) 100%);
        }

        .health-status-warning {
            background: linear-gradient(135deg, hsl(43 96% 56%) 0%, hsl(43 90% 65%) 100%);
        }

        .health-status-danger {
            background: linear-gradient(135deg, hsl(0 84.2% 60.2%) 0%, hsl(0 80% 70%) 100%);
        }

        .heart-rate-display {
            font-family: 'Inter', monospace;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .modal-backdrop {
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body class="min-h-screen bg-background">
    <!-- @COMPONENT: Header -->
    <header class="bg-card border-b border-border shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <div class="bg-primary text-primary-foreground rounded-lg p-2">
                        <i class="fas fa-heartbeat text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-semibold text-foreground">Heart Monitor</h1>
                        <p class="text-sm text-muted-foreground">Real-time Health Monitoring</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-accent rounded-full pulse-animation"></div>
                        <span class="text-sm text-muted-foreground" data-mock="true">Live</span>
                    </div>
                    <button class="bg-primary text-primary-foreground px-4 py-2 rounded-md text-sm font-medium hover:bg-primary/90 transition-colors" data-event="click:handleSettings">
                        <i class="fas fa-cog mr-2"></i>Settings
                    </button>
                </div>
            </div>
        </div>
    </header>
    <!-- @END_COMPONENT: Header -->

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- @COMPONENT: PatientInfo -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
            <div class="lg:col-span-1">
                <div class="bg-card rounded-lg shadow-sm border border-border p-6">
                    <h2 class="text-lg font-semibold text-foreground mb-4">Patient Information</h2>
                    <form class="space-y-4" data-implementation="Form submission should update patient context">
                        <div>
                            <label for="patientName" class="block text-sm font-medium text-foreground mb-2">Full Name</label>
                            <input 
                                type="text" 
                                id="patientName" 
                                placeholder="Enter patient name" 
                                class="w-full px-3 py-2 border border-input rounded-md focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent"
                                data-bind="patient.name"
                                data-mock="true"
                                value="John Doe"
                            />
                        </div>
                        <div>
                            <label for="patientAge" class="block text-sm font-medium text-foreground mb-2">Age</label>
                            <input 
                                type="number" 
                                id="patientAge" 
                                placeholder="Enter age" 
                                min="1" 
                                max="120"
                                class="w-full px-3 py-2 border border-input rounded-md focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent"
                                data-bind="patient.age"
                                data-mock="true"
                                value="35"
                            />
                        </div>
                        <button 
                            type="submit" 
                            class="w-full bg-primary text-primary-foreground py-2 px-4 rounded-md font-medium hover:bg-primary/90 transition-colors"
                            data-event="click:handlePatientUpdate"
                        >
                            Update Patient Info
                        </button>
                    </form>
                </div>
            </div>
            <!-- @END_COMPONENT: PatientInfo -->

            <!-- @COMPONENT: CurrentStats -->
            <div class="lg:col-span-2">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Heart Rate Display -->
                    <div class="bg-card rounded-lg shadow-sm border border-border p-6 text-center">
                        <div class="flex items-center justify-center mb-3">
                            <i class="fas fa-heartbeat text-3xl text-destructive pulse-animation"></i>
                        </div>
                        <div class="heart-rate-display text-4xl text-foreground mb-2" data-bind="heartRate.current" data-mock="true">
                            72
                        </div>
                        <p class="text-sm text-muted-foreground">BPM</p>
                        <p class="text-xs text-muted-foreground mt-1">Current Heart Rate</p>
                    </div>

                    <!-- Health Status -->
                    <div class="bg-card rounded-lg shadow-sm border border-border p-6 text-center">
                        <div class="w-16 h-16 mx-auto mb-3 rounded-full health-status-healthy flex items-center justify-center" data-bind="healthStatus.indicator">
                            <i class="fas fa-check text-2xl text-white"></i>
                        </div>
                        <p class="font-semibold text-foreground" data-bind="healthStatus.text" data-mock="true">Healthy</p>
                        <p class="text-xs text-muted-foreground mt-1">Current Status</p>
                    </div>

                    <!-- Average BPM -->
                    <div class="bg-card rounded-lg shadow-sm border border-border p-6 text-center">
                        <div class="flex items-center justify-center mb-3">
                            <i class="fas fa-chart-line text-3xl text-secondary"></i>
                        </div>
                        <div class="text-3xl font-bold text-foreground mb-2" data-bind="heartRate.average" data-mock="true">
                            74
                        </div>
                        <p class="text-sm text-muted-foreground">Avg BPM</p>
                        <p class="text-xs text-muted-foreground mt-1">Last 5 minutes</p>
                    </div>
                </div>
            </div>
            <!-- @END_COMPONENT: CurrentStats -->
        </div>

        <!-- @COMPONENT: Charts -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Real-time Heart Rate Chart -->
            <div class="bg-card rounded-lg shadow-sm border border-border p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-foreground">Real-time Heart Rate</h3>
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-destructive rounded-full pulse-animation"></div>
                        <span class="text-xs text-muted-foreground">Live Feed</span>
                    </div>
                </div>
                <div class="h-64">
                    <canvas id="realtimeChart" class="w-full h-full" data-implementation="Connect to real-time heart rate data stream"></canvas>
                </div>
            </div>

            <!-- Heart Rate Zones -->
            <div class="bg-card rounded-lg shadow-sm border border-border p-6">
                <h3 class="text-lg font-semibold text-foreground mb-4">Heart Rate Zones</h3>
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-3 bg-accent/10 rounded-md">
                        <div class="flex items-center space-x-3">
                            <div class="w-4 h-4 bg-accent rounded-full"></div>
                            <span class="text-sm font-medium">Resting Zone</span>
                        </div>
                        <span class="text-sm text-muted-foreground" data-bind="zones.resting" data-mock="true">50-70 BPM</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-blue-50 rounded-md">
                        <div class="flex items-center space-x-3">
                            <div class="w-4 h-4 bg-blue-500 rounded-full"></div>
                            <span class="text-sm font-medium">Normal Zone</span>
                        </div>
                        <span class="text-sm text-muted-foreground" data-bind="zones.normal" data-mock="true">70-100 BPM</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-yellow-50 rounded-md">
                        <div class="flex items-center space-x-3">
                            <div class="w-4 h-4 bg-yellow-500 rounded-full"></div>
                            <span class="text-sm font-medium">Elevated Zone</span>
                        </div>
                        <span class="text-sm text-muted-foreground" data-bind="zones.elevated" data-mock="true">100-120 BPM</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-red-50 rounded-md">
                        <div class="flex items-center space-x-3">
                            <div class="w-4 h-4 bg-destructive rounded-full"></div>
                            <span class="text-sm font-medium">Danger Zone</span>
                        </div>
                        <span class="text-sm text-muted-foreground" data-bind="zones.danger" data-mock="true">120+ BPM</span>
                    </div>
                </div>
            </div>
        </div>
        <!-- @END_COMPONENT: Charts -->

        <!-- @COMPONENT: HistoryChart -->
        <div class="bg-card rounded-lg shadow-sm border border-border p-6 mb-8">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-foreground">Heart Rate History</h3>
                <div class="flex items-center space-x-2">
                    <select class="px-3 py-1 border border-input rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring" data-event="change:handleTimeRangeChange">
                        <option value="1h">Last Hour</option>
                        <option value="6h">Last 6 Hours</option>
                        <option value="24h">Last 24 Hours</option>
                        <option value="7d">Last 7 Days</option>
                    </select>
                </div>
            </div>
            <div class="h-80">
                <canvas id="historyChart" class="w-full h-full" data-implementation="Display historical heart rate data with time-based filtering"></canvas>
            </div>
        </div>
        <!-- @END_COMPONENT: HistoryChart -->

        <!-- @COMPONENT: ConnectionStatus -->
        <div class="bg-card rounded-lg shadow-sm border border-border p-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-3 h-3 bg-accent rounded-full pulse-animation" data-bind="connection.status"></div>
                    <span class="text-sm font-medium text-foreground">AD8232 Sensor</span>
                    <span class="text-xs text-muted-foreground" data-bind="connection.statusText" data-mock="true">Connected</span>
                </div>
                <div class="flex items-center space-x-4 text-xs text-muted-foreground">
                    <span>Signal Quality: <span class="text-foreground font-medium" data-bind="sensor.quality" data-mock="true">98%</span></span>
                    <span>Last Update: <span class="text-foreground font-medium" data-bind="sensor.lastUpdate" data-mock="true">Just now</span></span>
                </div>
            </div>
        </div>
        <!-- @END_COMPONENT: ConnectionStatus -->
    </div>

    <!-- @COMPONENT: AlertModal -->
    <div id="alertModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop bg-black bg-opacity-50 hidden" data-state="hidden">
        <div class="bg-card rounded-lg shadow-xl border border-border max-w-md w-full p-6 animate-in">
            <div class="flex items-center space-x-3 mb-4">
                <div class="w-12 h-12 bg-destructive text-destructive-foreground rounded-full flex items-center justify-center">
                    <i class="fas fa-exclamation-triangle text-xl"></i>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-foreground">Health Alert</h3>
                    <p class="text-sm text-muted-foreground">Abnormal heart rate detected</p>
                </div>
            </div>
            <div class="mb-6">
                <p class="text-foreground mb-2" data-bind="alert.message" data-mock="true">
                    The patient's heart rate has exceeded safe limits (145 BPM). Please check on the patient immediately.
                </p>
                <div class="bg-muted rounded-md p-3">
                    <div class="flex justify-between text-sm">
                        <span>Current BPM:</span>
                        <span class="font-semibold text-destructive" data-bind="alert.currentBPM" data-mock="true">145</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span>Safe Range:</span>
                        <span class="font-semibold" data-bind="alert.safeRange" data-mock="true">60-100</span>
                    </div>
                </div>
            </div>
            <div class="flex space-x-3">
                <button class="flex-1 bg-destructive text-destructive-foreground py-2 px-4 rounded-md font-medium hover:bg-destructive/90 transition-colors" data-event="click:handleEmergencyCall">
                    <i class="fas fa-phone mr-2"></i>Call Emergency
                </button>
                <button class="flex-1 bg-muted text-muted-foreground py-2 px-4 rounded-md font-medium hover:bg-muted/80 transition-colors" data-event="click:handleDismissAlert">
                    Dismiss
                </button>
            </div>
        </div>
    </div>
    <!-- @END_COMPONENT: AlertModal -->

    <script>
        (function() {
            // Mock data for demonstration
            let currentHeartRate = 72;
            let heartRateHistory = [];
            let realtimeChart, historyChart;

            // Initialize charts
            function initializeCharts() {
                // Real-time chart
                const realtimeCtx = document.getElementById('realtimeChart').getContext('2d');
                realtimeChart = new Chart(realtimeCtx, {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 20}, (_, i) => `-${19-i}s`),
                        datasets: [{
                            label: 'Heart Rate',
                            data: Array.from({length: 20}, () => Math.floor(Math.random() * 20) + 65),
                            borderColor: 'hsl(0 84.2% 60.2%)',
                            backgroundColor: 'hsl(0 84.2% 60.2% / 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointRadius: 2,
                            pointBackgroundColor: 'hsl(0 84.2% 60.2%)',
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: false,
                                min: 50,
                                max: 120,
                                grid: {
                                    color: 'hsl(214.3 31.8% 91.4%)'
                                }
                            },
                            x: {
                                grid: {
                                    color: 'hsl(214.3 31.8% 91.4%)'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        animation: {
                            duration: 750
                        }
                    }
                });

                // History chart
                const historyCtx = document.getElementById('historyChart').getContext('2d');
                const historyLabels = Array.from({length: 60}, (_, i) => `${i}m`);
                const historyData = Array.from({length: 60}, () => Math.floor(Math.random() * 30) + 60);
                
                historyChart = new Chart(historyCtx, {
                    type: 'line',
                    data: {
                        labels: historyLabels,
                        datasets: [{
                            label: 'Heart Rate (BPM)',
                            data: historyData,
                            borderColor: 'hsl(221.2 83.2% 53.3%)',
                            backgroundColor: 'hsl(221.2 83.2% 53.3% / 0.1)',
                            tension: 0.3,
                            fill: true,
                            pointRadius: 1,
                            pointBackgroundColor: 'hsl(221.2 83.2% 53.3%)',
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: false,
                                min: 50,
                                max: 130,
                                grid: {
                                    color: 'hsl(214.3 31.8% 91.4%)'
                                }
                            },
                            x: {
                                grid: {
                                    color: 'hsl(214.3 31.8% 91.4%)'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }

            // Simulate real-time heart rate updates
            function updateRealTimeData() {
                // Generate new heart rate value (simulate sensor fluctuation)
                const variation = (Math.random() - 0.5) * 10;
                currentHeartRate = Math.max(50, Math.min(150, currentHeartRate + variation));
                
                // Update real-time chart
                realtimeChart.data.datasets[0].data.shift();
                realtimeChart.data.datasets[0].data.push(Math.round(currentHeartRate));
                realtimeChart.update('none');

                // Update current heart rate display
                document.querySelector('[data-bind="heartRate.current"]').textContent = Math.round(currentHeartRate);

                // Check for alerts
                checkHealthAlerts(Math.round(currentHeartRate));

                // Update average (mock calculation)
                const avgElement = document.querySelector('[data-bind="heartRate.average"]');
                if (avgElement) {
                    const currentAvg = parseInt(avgElement.textContent);
                    const newAvg = Math.round((currentAvg + currentHeartRate) / 2);
                    avgElement.textContent = newAvg;
                }
            }

            // Check for health alerts
            function checkHealthAlerts(heartRate) {
                const patientAge = parseInt(document.getElementById('patientAge').value) || 35;
                const maxHeartRate = 220 - patientAge;
                const dangerThreshold = maxHeartRate * 0.85; // 85% of max heart rate

                if (heartRate > dangerThreshold || heartRate < 50) {
                    showAlert(heartRate);
                }

                // Update health status
                updateHealthStatus(heartRate, dangerThreshold);
            }

            // Update health status indicator
            function updateHealthStatus(heartRate, dangerThreshold) {
                const statusIndicator = document.querySelector('[data-bind="healthStatus.indicator"]');
                const statusText = document.querySelector('[data-bind="healthStatus.text"]');
                
                if (heartRate > dangerThreshold || heartRate < 50) {
                    statusIndicator.className = statusIndicator.className.replace(/health-status-\w+/, 'health-status-danger');
                    statusIndicator.innerHTML = '<i class="fas fa-exclamation-triangle text-2xl text-white"></i>';
                    statusText.textContent = 'Critical';
                } else if (heartRate > 100) {
                    statusIndicator.className = statusIndicator.className.replace(/health-status-\w+/, 'health-status-warning');
                    statusIndicator.innerHTML = '<i class="fas fa-exclamation text-2xl text-white"></i>';
                    statusText.textContent = 'Elevated';
                } else {
                    statusIndicator.className = statusIndicator.className.replace(/health-status-\w+/, 'health-status-healthy');
                    statusIndicator.innerHTML = '<i class="fas fa-check text-2xl text-white"></i>';
                    statusText.textContent = 'Healthy';
                }
            }

            // Show alert modal
            function showAlert(heartRate) {
                const modal = document.getElementById('alertModal');
                const currentBPMElement = document.querySelector('[data-bind="alert.currentBPM"]');
                
                if (currentBPMElement) {
                    currentBPMElement.textContent = heartRate;
                }
                
                modal.classList.remove('hidden');
                
                // Auto-dismiss after 10 seconds if not manually dismissed
                setTimeout(() => {
                    if (!modal.classList.contains('hidden')) {
                        modal.classList.add('hidden');
                    }
                }, 10000);
            }

            // Event listeners
            document.addEventListener('click', function(e) {
                if (e.target.closest('[data-event*="handleDismissAlert"]')) {
                    document.getElementById('alertModal').classList.add('hidden');
                }
                
                if (e.target.closest('[data-event*="handleEmergencyCall"]')) {
                    alert('Emergency services would be contacted in a real implementation');
                    document.getElementById('alertModal').classList.add('hidden');
                }
            });

            // Initialize on page load
            document.addEventListener('DOMContentLoaded', function() {
                initializeCharts();
                
                // Start real-time updates
                setInterval(updateRealTimeData, 1000);
                
                // Update connection timestamp
                setInterval(() => {
                    const lastUpdateElement = document.querySelector('[data-bind="sensor.lastUpdate"]');
                    if (lastUpdateElement) {
                        lastUpdateElement.textContent = 'Just now';
                    }
                }, 5000);
            });

            // TODO: Implement WebSocket connection to real AD8232 sensor
            // TODO: Implement proper patient data persistence
            // TODO: Implement historical data storage and retrieval
            // TODO: Implement proper alert system with notification API
            // TODO: Implement settings for customizable heart rate thresholds
        })();
    </script>
</body>
</html>